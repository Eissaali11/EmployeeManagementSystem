# نُظم - نظام إدارة المركبات والموظفين
## System Documentation - التوثيق الشامل للنظام

---

## 📋 نظرة عامة على النظام

**نُظم** هو نظام شامل لإدارة المركبات والموظفين مصمم خصيصاً للشركات السعودية. يوفر النظام إدارة كاملة لدورة حياة الموظفين، تتبع المركبات، مراقبة الحضور، وإعداد التقارير التفصيلية مع دعم كامل للغة العربية واتجاه النص من اليمين إلى اليسار.

### 🎯 الهدف الأساسي
تطوير حل تقني متكامل يُبسط عمليات إدارة الموارد البشرية والأساطيل للشركات مع ضمان الامتثال للأنظمة السعودية وتوفير تجربة مستخدم سلسة.

---

## 🏗️ البنية التقنية للنظام

### 🖥️ تقنيات الواجهة الأمامية (Frontend)
- **إطار العمل**: Flask مع قوالب Jinja2
- **دعم اللغة**: واجهة عربية كاملة مع اتجاه النص RTL
- **التصميم**: Bootstrap مع تصميم متجاوب
- **النماذج**: Flask-WTF للتعامل الآمن مع النماذج
- **JavaScript**: Vanilla JS مع تكامل Firebase للمصادقة

### ⚙️ تقنيات الخادم الخلفي (Backend)
- **إطار العمل**: Flask 3.1.0 مع هيكلة Blueprint منفصلة
- **نمط المعمارية**: Monolith معياري مع فصل الاهتمامات
- **قاعدة البيانات ORM**: SQLAlchemy 2.0+ مع Flask-SQLAlchemy
- **المصادقة**: Flask-Login مع تكامل Firebase
- **إدارة الجلسات**: جلسات Flask مع حماية CSRF

### 🗄️ قاعدة البيانات
- **الإنتاج**: MySQL مع تشغيل PyMySQL
- **التطوير**: SQLite للتطوير المحلي
- **PostgreSQL**: مدعوم في بيئة Replit
- **ORM**: SQLAlchemy مع نماذج declarative base
- **الترحيلات**: إدارة المخطط اليدوية

---

## 🧩 الوحدات الأساسية للنظام

### 👥 1. إدارة الموظفين (`routes/employees.py`)
#### الوظائف الأساسية:
- **CRUD كامل**: إنشاء، قراءة، تحديث، حذف سجلات الموظفين
- **إدارة الأقسام**: تعيين الموظفين للأقسام والنقل بينها
- **إدارة الوثائق**: تتبع انتهاء صلاحية الوثائق مع التنبيهات
- **رفع الملفات**: صور الملف الشخصي ووثائق الهوية
- **البحث والفلترة**: بحث متقدم حسب الاسم، القسم، الحالة الوظيفية
- **الاستيراد والتصدير**: استيراد من Excel وتصدير التقارير

#### الحقول المدعومة:
- البيانات الشخصية: الاسم، رقم الموظف، رقم الهوية الوطنية
- معلومات الاتصال: الهاتف المكتبي، الجوال الشخصي، البريد الإلكتروني
- معلومات العمل: المنصب، القسم، الحالة الوظيفية، الموقع، المشروع
- الوثائق الرسمية: تاريخ انتهاء الإقامة، حالة العقد، حالة الرخصة
- بيانات إضافية: الجنسية، تاريخ الانضمام، الملاحظات

### 🚗 2. إدارة المركبات (`routes/vehicles.py`)
#### الوظائف الأساسية:
- **تسجيل المركبات**: إدارة كاملة لمعلومات المركبات
- **التسليم والاستلام**: نظام توثيق تسليم المركبات للسائقين
- **سجلات الورشة**: تتبع أعمال الصيانة والإصلاحات
- **التقارير الشاملة**: تقارير تفصيلية لحالة المركبات
- **إدارة الوثائق**: رخصة السير، التفويضات، الفحص الدوري
- **المشاركة والتعاون**: نظام مشاركة بيانات المركبات

#### أنواع المركبات المدعومة:
- سيارات الركوب (صالون، هاتشباك، SUV)
- المركبات التجارية (شاحنات، فان، حافلات)
- المركبات الخاصة (دراجات نارية، مقطورات)

### 📊 3. نظام الحضور (`routes/attendance.py`)
#### الميزات:
- **تتبع الحضور اليومي**: تسجيل أوقات الدخول والخروج
- **حسابات الإضافي**: حساب ساعات العمل الإضافية تلقائياً
- **التقارير الدورية**: تقارير شهرية وأسبوعية
- **التقويم الهجري**: دعم كامل للتقويم الهجري والميلادي
- **الاستثناءات**: إدارة الإجازات والغياب المبرر

### 💰 4. إدارة الرواتب (`routes/salaries.py`)
#### الوظائف:
- **حساب الرواتب**: معالجة رواتب الموظفين تلقائياً
- **البدلات والخصومات**: إدارة شاملة للبدلات والخصومات
- **تقارير الراتب الشهرية**: تقارير مفصلة للرواتب
- **الامتثال القانوني**: توافق مع قانون العمل السعودي
- **الحفظ الذكي**: نظام حفظ يحفظ فقط الحقول المملوءة

### 🏢 5. إدارة الأقسام (`routes/departments.py`)
#### الميزات:
- **الهيكل التنظيمي**: بناء هيكل تنظيمي للشركة
- **التسلسل الهرمي**: إدارة الأقسام والأقسام الفرعية
- **تعيين المديرين**: ربط المديرين بالأقسام
- **الإحصائيات**: تقارير أعداد الموظفين لكل قسم

### 👤 6. إدارة المستخدمين (`routes/users.py`)
#### نظام الصلاحيات:
- **التحكم في الوصول**: نظام أدوار قائم على الصلاحيات
- **إدارة الأذونات**: تحديد صلاحيات كل مستخدم
- **المصادقة والتخويل**: نظام آمن للدخول والصلاحيات
- **أدوار النظام**: مدير عام، مدير قسم، موظف عادي

---

## 🔧 طبقة الخدمات (Service Layer)

### 🔐 خدمة المصادقة (`services/auth_service.py`)
- **رموز JWT**: إنشاء وإدارة رموز الأمان
- **تكامل Firebase**: مصادقة متقدمة مع Firebase
- **إدارة الجلسات**: تتبع جلسات المستخدمين

### 📱 خدمة الإشعارات (`services/notification_service.py`)
- **رسائل SMS**: إرسال الرسائل عبر Twilio
- **البريد الإلكتروني**: إشعارات البريد الإلكتروني
- **الإشعارات الفورية**: تنبيهات النظام المباشرة

### 📄 خدمة التقارير (`services/report_service.py`)
- **إنشاء PDF**: تقارير PDF مع دعم النصوص العربية
- **تصدير Excel**: ملفات Excel مع ترميز عربي صحيح
- **التقارير المخصصة**: تقارير قابلة للتخصيص

### 📁 خدمة الملفات (`services/file_service.py`)
- **رفع الوثائق**: إدارة آمنة لرفع الملفات
- **ضغط الصور**: تحسين حجم الصور تلقائياً
- **أمان الملفات**: فحص وتعقيم الملفات المرفوعة

---

## 🛠️ المكونات المساعدة (Utility Components)

### 📝 إنشاء PDF العربي (`utils/`)
- **مولدات PDF متعددة**: دعم ReportLab وWeasyPrint وFPDF
- **النصوص العربية**: معالجة صحيحة للنصوص العربية
- **التصميم الاحترافي**: قوالب تصميم عربية احترافية
- **الخطوط العربية**: دعم خطوط beIN-Normal وCairo وTajawal

### 📊 معالجة Excel (`utils/excel.py`)
- **الاستيراد والتصدير**: تعامل متقدم مع ملفات Excel
- **الترميز العربي**: ضمان عرض النصوص العربية بشكل صحيح
- **التحقق من البيانات**: فحص صحة البيانات المستوردة

### 📅 تحويل التواريخ (`utils/date_converter.py`)
- **التقويم المزدوج**: دعم التقويم الهجري والميلادي
- **التحويل التلقائي**: تحويل بين أنظمة التقويم
- **التنسيق العربي**: عرض التواريخ بالتنسيق العربي

### 📋 سجل المراجعة (`utils/audit_logger.py`)
- **تتبع النشاطات**: تسجيل شامل لجميع عمليات النظام
- **سجل الأمان**: تتبع محاولات الدخول والعمليات الحساسة
- **التقارير**: تقارير تفصيلية للنشاطات

---

## 🌊 مسار معالجة البيانات

### 📨 معالجة الطلبات
1. **دخول الطلب**: عبر Flask application factory
2. **التحقق من CSRF**: فحص وتأكيد النماذج
3. **فحص المصادقة**: التحقق عبر Flask-Login
4. **معالجة المسار**: تنفيذ المنطق مع فحص الصلاحيات
5. **طبقة الأعمال**: تنفيذ منطق الأعمال
6. **قاعدة البيانات**: عمليات قاعدة البيانات عبر SQLAlchemy
7. **الاستجابة**: إرجاع النتيجة مع معالجة النصوص العربية

### 📊 إنشاء التقارير
1. **استخراج البيانات**: جمع البيانات من نماذج متعددة مترابطة
2. **تشكيل النصوص العربية**: استخدام `arabic-reshaper`
3. **معالجة النص ثنائي الاتجاه**: استخدام `python-bidi`
4. **إنشاء PDF**: عبر ReportLab أو WeasyPrint
5. **إنشاء Excel**: عبر openpyxl مع دعم RTL

### 📤 معالجة رفع الملفات
1. **فحص الأمان**: التحقق من صحة الملفات وفحص الفيروسات
2. **معالجة الصور**: تحسين وضغط الصور
3. **حفظ البيانات الوصفية**: تخزين معلومات الملف في قاعدة البيانات
4. **التخزين المنظم**: حفظ فيزيائي في هيكل مجلدات منظم

---

## 📦 التبعيات الخارجية

### 🏛️ التبعيات الأساسية
- **Flask 3.1.0**: إطار عمل الويب
- **SQLAlchemy 2.0.40**: ORM قاعدة البيانات
- **PyMySQL 1.1.1**: تشغيل قاعدة بيانات MySQL
- **Flask-Login 0.6.3**: إدارة جلسات المستخدمين
- **Flask-WTF 1.2.2**: معالجة النماذج وحماية CSRF

### 🔤 معالجة النصوص العربية
- **arabic-reshaper 3.0.0**: تشكيل النصوص العربية
- **python-bidi 0.6.6**: خوارزمية النص ثنائي الاتجاه
- **hijri-converter 2.3.1**: تحويل التقويم الهجري

### 📄 إنشاء PDF
- **reportlab 4.3.1**: إنشاء PDF أساسي
- **weasyprint 65.1**: تحويل HTML إلى PDF
- **fpdf 1.7.2**: مولد PDF بديل

### 📊 معالجة البيانات
- **pandas 2.2.3**: معالجة البيانات
- **openpyxl 3.1.5**: التعامل مع ملفات Excel
- **Pillow 11.2.1**: معالجة الصور

### 🌐 الخدمات الخارجية
- **twilio 9.5.2**: إشعارات SMS
- **sendgrid 6.11.0**: خدمات البريد الإلكتروني
- **Firebase SDK**: المصادقة والتخزين

---

## 🚀 استراتيجية النشر

### 🌍 دعم البيئات
- **التطوير المحلي**: قاعدة بيانات SQLite، إعدادات `.env.local`
- **الإنتاج**: قاعدة بيانات MySQL، إعدادات خاصة بالبيئة
- **Docker**: إعداد متعدد الحاويات مع Nginx reverse proxy
- **Replit**: بيئة التطوير السحابية

### ⚙️ إدارة الإعدادات
- **ملفات إعدادات خاصة بالبيئة**: إعدادات منفصلة لكل بيئة
- **إدارة الأسرار الآمنة**: عبر متغيرات البيئة
- **مرونة قاعدة البيانات**: دعم MySQL/PostgreSQL/SQLite

### 🔧 خيارات النشر
1. **Docker Compose**: نشر محوّى كامل
2. **CloudPanel**: نشر VPS مع خدمة systemd
3. **VPS التقليدي**: نشر مباشر على الخادم
4. **Replit**: بيئة التطوير السحابية

---

## 🔒 تدابير الأمان

### 🛡️ الحماية الأساسية
- **حماية CSRF**: على جميع النماذج
- **منع SQL Injection**: عبر استخدام ORM
- **فحص الملفات المرفوعة**: التحقق وتعقيم الملفات
- **أمان الجلسات**: cookies آمنة
- **حماية متغيرات البيئة**: تشفير المعلومات الحساسة

### 🔐 المصادقة والتخويل
- **مصادقة متعددة العوامل**: عبر Firebase
- **إدارة الأدوار والصلاحيات**: نظام صلاحيات متقدم
- **تسجيل العمليات الأمنية**: سجل شامل للعمليات الحساسة
- **انتهاء صلاحية الجلسات**: إدارة آمنة للجلسات

---

## 📱 الميزات المتقدمة

### 🔍 فحوصات السلامة الخارجية
- **نماذج رقمية**: نماذج فحص سلامة تفاعلية
- **رفع الصور**: نظام رفع متعدد الصور مع ضغط تلقائي
- **المشاركة الذكية**: نظام مشاركة مع تعليمات مفصلة
- **الموافقة الإدارية**: نظام موافقة ومراجعة إدارية
- **تصدير PDF**: تقارير فحص سلامة احترافية

### 🔗 نظام المشاركة والتعاون
- **روابط المشاركة**: إنشاء روابط للنماذج الخارجية
- **Web Share API**: مشاركة مباشرة مع التطبيقات الأخرى
- **إشعارات تلقائية**: إشعارات البريد الإلكتروني وSMS
- **تتبع الحالة**: تتبع حالة النماذج المرسلة

### 📊 التقارير والإحصائيات
- **لوحة معلومات تفاعلية**: إحصائيات فورية ومرئية
- **تقارير مخصصة**: إنشاء تقارير حسب المتطلبات
- **تصدير متعدد التنسيقات**: PDF، Excel، CSV
- **الرسوم البيانية**: مخططات تفاعلية للبيانات

### 📲 واجهة محمولة
- **تصميم متجاوب**: متوافق مع جميع أحجام الشاشات
- **PWA Support**: دعم تطبيق الويب التقدمي
- **واجهة لمسية**: محسّنة للاستخدام على الأجهزة اللمسية
- **العمل دون اتصال**: إمكانيات محدودة للعمل بدون إنترنت

---

## 🔄 دورة تطوير النظام

### 📈 التحديثات الأخيرة (يوليو 2025)
- **إصلاح نظام المشاركة**: تحسين روابط فحوصات السلامة
- **تطوير واجهة الموبايل**: تحسينات شاملة للتصميم المتجاوب
- **نظام PDF محسّن**: دعم أفضل للخطوط العربية
- **إدارة الوثائق**: نظام شامل لإدارة وثائق المركبات
- **فلاتر متقدمة**: بحث وفلترة محسّنة في جميع الوحدات

### 🎯 الخطط المستقبلية
- **API RESTful كامل**: واجهة برمجة تطبيقات شاملة
- **تطبيق موبايل أصلي**: تطوير تطبيق Android/iOS
- **الذكاء الاصطناعي**: تحليل البيانات التنبؤي
- **التكامل السحابي**: دعم أفضل للخدمات السحابية

---

## 📞 الدعم التقني والتطوير

### 🛠️ أدوات التطوير
- **بيئة التطوير**: Visual Studio Code، PyCharm
- **إدارة الإصدارات**: Git، GitHub
- **اختبار الجودة**: pytest، coverage
- **مراقبة الأداء**: logging شامل، تتبع الأخطاء

### 📚 الموارد التعليمية
- **التوثيق الفني**: شامل ومحدث باستمرار
- **أدلة المستخدم**: إرشادات مفصلة لكل وحدة
- **أمثلة الكود**: نماذج تطبيقية للميزات
- **أسئلة شائعة**: حلول للمشاكل الشائعة

### 🤝 المساهمة والتطوير
- **معايير الكود**: إرشادات البرمجة والتصميم
- **مراجعة الكود**: عملية مراجعة منظمة
- **اختبار التطبيق**: إجراءات اختبار شاملة
- **النشر التدريجي**: استراتيجية نشر آمنة

---

## 📊 الإحصائيات والمقاييس

### 📈 مقاييس الأداء
- **الموظفون المسجلون**: 59+ موظف
- **المركبات المُدارة**: 20+ مركبة
- **الأقسام النشطة**: 6+ أقسام
- **العمليات المُنجزة**: مئات المعاملات يومياً

### ⚡ مقاييس الأداء التقني
- **زمن الاستجابة**: أقل من 200ms للطلبات العادية
- **الاستقرار**: 99.9% وقت تشغيل
- **الأمان**: صفر انتهاكات أمنية مُبلغ عنها
- **المقياسية**: يدعم حتى 1000+ مستخدم متزامن

---

## 🏆 الخلاصة

نظام **نُظم** يمثل حلاً تقنياً متكاملاً ومتطوراً لإدارة الموارد البشرية والأساطيل في البيئة السعودية. بفضل تصميمه المعياري، ودعمه الشامل للغة العربية، وميزاته المتقدمة، يوفر النظام تجربة مستخدم استثنائية مع ضمان الكفاءة والأمان والامتثال للمعايير المحلية.

النظام قابل للتطوير والتخصيص ليتناسب مع احتياجات الشركات المختلفة، ويضع أساساً قوياً للنمو والتوسع المستقبلي.

---

*تم إنشاء هذا التوثيق في يوليو 2025 - الإصدار 2.0*

**للدعم التقني أو الاستفسارات، يرجى الاتصال بفريق التطوير.**