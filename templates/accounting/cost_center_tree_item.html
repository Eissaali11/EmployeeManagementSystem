<!-- عنصر مركز التكلفة في العرض الشجري -->
<div class="cost-center-item">
    <div class="d-flex justify-content-between align-items-center">
        <div class="d-flex align-items-center">
            <i class="fas fa-building me-2 text-primary"></i>
            <div>
                <h6 class="mb-1 fw-bold">{{ center.code }} - {{ center.name }}</h6>
                {% if center.description %}
                <p class="mb-0 text-muted small">{{ center.description }}</p>
                {% endif %}
            </div>
        </div>
        
        <div class="d-flex align-items-center gap-3">
            <!-- معلومات الميزانية -->
            <div class="text-end">
                <div class="text-success fw-bold">{{ "{:,.0f}".format(center.budget_amount) }} ريال</div>
                <div class="text-muted small">
                    المصروف: {{ "{:,.0f}".format(center.get_actual_expenses()) }} ريال
                </div>
                {% set usage_percent = (center.get_actual_expenses() / center.budget_amount * 100) if center.budget_amount > 0 else 0 %}
                <div class="progress mt-1" style="height: 6px; width: 100px;">
                    <div class="progress-bar {% if usage_percent > 90 %}bg-danger{% elif usage_percent > 75 %}bg-warning{% else %}bg-success{% endif %}" 
                         style="width: {{ usage_percent|round(1) }}%"></div>
                </div>
            </div>
            
            <!-- الحالة -->
            {% if center.is_active %}
                <span class="badge bg-success">نشط</span>
            {% else %}
                <span class="badge bg-secondary">غير نشط</span>
            {% endif %}
            
            <!-- الإجراءات -->
            <div class="btn-group btn-group-sm">
                <a href="{{ url_for('accounting.view_cost_center', center_id=center.id) }}" 
                   class="btn btn-outline-primary" title="عرض التفاصيل">
                    <i class="fas fa-eye"></i>
                </a>
                {% if current_user.role.value == 'admin' %}
                <a href="{{ url_for('accounting.edit_cost_center', center_id=center.id) }}" 
                   class="btn btn-outline-warning" title="تعديل">
                    <i class="fas fa-edit"></i>
                </a>
                <button type="button" class="btn btn-outline-danger" 
                        onclick="confirmDelete({{ center.id }}, '{{ center.name }}')" title="حذف">
                    <i class="fas fa-trash"></i>
                </button>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- المراكز الفرعية -->
{% if center.children %}
<div class="cost-center-tree">
    {% for child in center.children %}
        {% set center = child %}
        {% include 'accounting/cost_center_tree_item.html' %}
    {% endfor %}
</div>
{% endif %}