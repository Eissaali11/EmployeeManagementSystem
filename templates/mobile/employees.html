{% extends 'mobile/layout.html' %}

{% block title %}الموظفون - نظام إدارة الموظفين{% endblock %}

{% block header_title %}الموظفون{% endblock %}

{% block header_actions %}
<button class="mobile-menu-button" aria-label="إضافة" onclick="location.href='{{ url_for('mobile.add_employee') }}'">
    <i class="fas fa-plus"></i>
</button>
{% endblock %}

{% block content %}
<!-- فلاتر البحث -->
<div class="mobile-card">
    <div class="mobile-card-title">
        <i class="fas fa-filter"></i> البحث والفلترة
    </div>
    
    <div class="mobile-card-content">
        <form action="{{ url_for('mobile.employees') }}" method="GET" class="mobile-form">
            <div class="mobile-form-group">
                <input type="text" name="search" class="mobile-form-control" placeholder="البحث عن اسم، رقم موظف..." value="{{ request.args.get('search', '') }}">
            </div>
            
            <div class="mobile-form-group">
                <select name="department_id" class="mobile-form-select">
                    <option value="">جميع الأقسام</option>
                    {% for department in departments %}
                    <option value="{{ department.id }}" {% if request.args.get('department_id')|int == department.id %}selected{% endif %}>{{ department.name }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="d-flex gap-2">
                <button type="submit" class="mobile-btn mobile-btn-primary" style="flex: 3">
                    <i class="fas fa-search"></i> بحث
                </button>
                <a href="{{ url_for('mobile.employees') }}" class="mobile-btn mobile-btn-secondary" style="flex: 1">
                    <i class="fas fa-redo"></i>
                </a>
            </div>
        </form>
    </div>
</div>

<!-- قائمة الموظفين -->
{% if employees %}
<div class="mobile-card">
    <div class="mobile-card-title">
        <i class="fas fa-users"></i> قائمة الموظفين ({{ employees|length }})
    </div>
    
    <div class="mobile-card-content">
        {% for employee in employees %}
        <div class="mobile-employee-card" onclick="location.href='{{ url_for('mobile.employee_details', employee_id=employee.id) }}'">
            <div class="mobile-employee-info-row">
                <div class="mobile-employee-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="mobile-employee-main-info">
                    <div class="mobile-employee-name">{{ employee.name }}</div>
                    <div class="mobile-employee-subtitle">
                        {% if employee.employee_id %}
                            <span class="mobile-employee-id-mini">{{ employee.employee_id }}</span>
                        {% endif %}
                        {% if employee.job_title %}
                            <span>{{ employee.job_title }}</span>
                        {% endif %}
                        {% if employee.department %}
                            <span>{{ employee.department.name }}</span>
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="mobile-employee-action">
                <i class="fas fa-chevron-left"></i>
            </div>
        </div>
        {% endfor %}
    </div>
    
    <!-- ترقيم الصفحات -->
    {% if pagination and pagination.pages > 1 %}
    <div class="mobile-pagination">
        {% if pagination.has_prev %}
        {% set args = request.args.copy() %}
        {% if args.get('page') %}{% set _ = args.pop('page') %}{% endif %}
        <a href="{{ url_for('mobile.employees', page=pagination.prev_num, **args) }}" class="mobile-pagination-item">
            <i class="fas fa-chevron-right"></i>
        </a>
        {% endif %}
        
        {# ترقيم الصفحات البسيط #}
        {% for page_num in range(1, pagination.pages + 1) %}
            {% if page_num == pagination.page %}
                <span class="mobile-pagination-item active">{{ page_num }}</span>
            {% else %}
                {% set args = request.args.copy() %}
                {% if args.get('page') %}{% set _ = args.pop('page') %}{% endif %}
                <a href="{{ url_for('mobile.employees', page=page_num, **args) }}" class="mobile-pagination-item">{{ page_num }}</a>
            {% endif %}
        {% endfor %}
        
        {% if pagination.has_next %}
        {% set args = request.args.copy() %}
        {% if args.get('page') %}{% set _ = args.pop('page') %}{% endif %}
        <a href="{{ url_for('mobile.employees', page=pagination.next_num, **args) }}" class="mobile-pagination-item">
            <i class="fas fa-chevron-left"></i>
        </a>
        {% endif %}
    </div>
    {% endif %}
</div>
{% else %}
<div class="mobile-card">
    <div class="mobile-card-content text-center py-5">
        <i class="fas fa-users fa-3x text-secondary mb-3"></i>
        <h5>لا يوجد موظفين</h5>
        <p class="text-secondary">لا توجد بيانات موظفين متطابقة مع معايير البحث</p>
        <a href="{{ url_for('mobile.add_employee') }}" class="mobile-btn mobile-btn-primary mt-3">
            <i class="fas fa-plus"></i> إضافة موظف جديد
        </a>
    </div>
</div>
{% endif %}

<style>
/* بطاقات الموظفين المضغوطة - تصميم محسن */
.mobile-employee-card {
    background: white;
    border-radius: 12px;
    padding: 12px;
    margin-bottom: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    border: 1px solid #e9ecef;
    transition: all 0.3s ease;
    cursor: pointer;
    position: relative;
    overflow: hidden;
}

.mobile-employee-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, #34C759, #30D158);
}

.mobile-employee-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
    border-color: #34C759;
}

.mobile-employee-card:last-child {
    margin-bottom: 0;
}

.mobile-employee-info-row {
    display: flex;
    align-items: center;
    gap: 10px;
    flex: 1;
}

.mobile-employee-avatar {
    width: 36px;
    height: 36px;
    background: linear-gradient(135deg, #34C759, #30D158);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 16px;
    flex-shrink: 0;
}

.mobile-employee-main-info {
    flex: 1;
    min-width: 0;
}

.mobile-employee-name {
    font-size: 14px;
    font-weight: 600;
    color: #1a1a1a;
    margin-bottom: 2px;
    line-height: 1.2;
}

.mobile-employee-subtitle {
    font-size: 12px;
    color: #6c757d;
    display: flex;
    align-items: center;
    gap: 8px;
    line-height: 1.2;
}

.mobile-employee-id-mini {
    background: #f8f9fa;
    color: #333;
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 10px;
    font-weight: 600;
    border: 1px solid #e9ecef;
}

.mobile-employee-action {
    color: #8e8e93;
    font-size: 12px;
}

.mobile-employee-details i {
    margin-left: 5px;
}

.mobile-employee-action {
    color: #bbb;
}

.mobile-pagination {
    display: flex;
    justify-content: center;
    margin-top: 20px;
    padding-top: 15px;
    border-top: 1px solid #eee;
}

.mobile-pagination-item {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 35px;
    height: 35px;
    margin: 0 5px;
    border-radius: 4px;
    border: 1px solid #ddd;
    text-decoration: none;
    color: #757575;
}

.mobile-pagination-item.active {
    background-color: var(--primary-color);
    color: white;
    border-color: var(--primary-color);
}
</style>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('تم تحميل صفحة الموظفين');
});
</script>
{% endblock %}