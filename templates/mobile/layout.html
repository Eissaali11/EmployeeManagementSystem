<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <title>{% block title %}نظام إدارة الموظفين{% endblock %} - نُظم</title>
  
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  
  <!-- FontAwesome Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- تحميل خط تاجوال للعربية -->
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@200;300;400;500;700;800;900&display=swap" rel="stylesheet">
  
  <!-- تحميل Select2 للقوائم المنسدلة -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  
  <!-- رسائل الـ Flash -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="container-fluid px-0">
        {% for category, message in messages %}
          <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show mobile-alert" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}
  
  <!-- CSS الأساسي للتطبيق المحمول -->
  <link rel="stylesheet" href="{{ url_for('static', filename='mobile/css/mobile-style.css') }}">
  
  <!-- إعدادات المتغيرات -->
  <style>
    :root {
      --header-height: 60px;
      --footer-height: 70px;
      --primary-color: #2962ff;
      --secondary-color: #757de8;
      --success-color: #00c851;
      --danger-color: #ff3547;
      --warning-color: #fb3;
      --info-color: #33b5e5;
      --light-color: #f8f9fa;
      --dark-color: #343a40;
      --sidebar-width: 280px;
    }
  </style>
  
  <!-- إعدادات PWA -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="نظام إدارة الموظفين">
  <link rel="apple-touch-icon" href="{{ url_for('static', filename='mobile/img/logo.png') }}">
  
  {% block styles %}{% endblock %}
  
  <style>
    body {
      font-family: 'Tajawal', Arial, sans-serif;
    }
    
    .notification-badge {
      position: absolute;
      top: 5px;
      left: 5px;
      background-color: var(--danger-color);
      color: white;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      font-weight: bold;
    }
    
    /* تحسينات لوضع الشاشة المتجاوبة */
    @media (min-width: 992px) {
      .mobile-container {
        max-width: 450px;
        margin: 0 auto;
        box-shadow: 0 0 40px rgba(0, 0, 0, 0.1);
        height: 85vh;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        border-radius: 20px;
        position: relative;
      }
      
      .mobile-content-wrapper {
        flex: 1;
        overflow-y: auto;
        position: relative;
        padding-bottom: var(--footer-height);
      }
    }
  </style>
  <!-- في <head> -->
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" rel="stylesheet" />
</head>
<body>
  <div class="mobile-container">
    <!-- رأس التطبيق -->
    <header class="mobile-header">
      <div class="mobile-header-left">
        <button class="mobile-header-button" id="sidebar-toggle">
          <i class="fas fa-bars"></i>
        </button>
      </div>
      
      <h1 class="mobile-header-title">{% block header_title %}نظام إدارة الموظفين{% endblock %}</h1>
      
      <div class="mobile-header-right">
        <button class="mobile-header-button" onclick="location.href='{{ url_for('mobile.notifications') }}'">
          <i class="fas fa-bell"></i>
          {% if notifications_count and notifications_count > 0 %}
          <span class="notification-badge">{{ notifications_count if notifications_count < 10 else '9+' }}</span>
          {% endif %}
        </button>
      </div>
    </header>
    
    <!-- القائمة الجانبية -->
    <div class="mobile-sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">
          <img src="{{ url_for('static', filename='mobile/img/logo.png') }}" alt="شعار التطبيق" class="logo-img">
          <h2 class="sidebar-title">نظام إدارة الموظفين</h2>
        </div>
        <button class="sidebar-close" id="sidebar-close">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      {% if current_user.is_authenticated %}
      <div class="sidebar-user">
        <div class="sidebar-user-avatar">
          <img src="{{ current_user.profile_picture | default('https://ui-avatars.com/api/?name=' + (current_user.name or 'User') + '&background=2962ff&color=fff', true) }}" alt="{{ current_user.name or 'User' }}">
        </div>
        <div class="sidebar-user-info">
          <div class="sidebar-user-name">{{ current_user.name or 'مستخدم' }}</div>
          <div class="sidebar-user-role">{{ current_user.role | default('مستخدم', true) }}</div>
        </div>
      </div>
      {% endif %}
      
      <div class="sidebar-menu">
        <div class="sidebar-menu-title">القائمة الرئيسية</div>
        <ul class="sidebar-menu-items">
          <li class="sidebar-menu-item">
            <a href="{{ url_for('mobile.index') }}" class="sidebar-menu-link {{ 'active' if request.endpoint == 'mobile.index' }}">
              <span class="sidebar-menu-icon"><i class="fas fa-home"></i></span>
              <span class="sidebar-menu-text">الرئيسية</span>
            </a>
          </li>
          <li class="sidebar-menu-item">
            <a href="{{ url_for('mobile.employees') }}" class="sidebar-menu-link {{ 'active' if 'employees' in request.endpoint }}">
              <span class="sidebar-menu-icon"><i class="fas fa-users"></i></span>
              <span class="sidebar-menu-text">الموظفين</span>
            </a>
          </li>
          <li class="sidebar-menu-item">
            <a href="{{ url_for('mobile.attendance') }}" class="sidebar-menu-link {{ 'active' if 'attendance' in request.endpoint }}">
              <span class="sidebar-menu-icon"><i class="fas fa-calendar-check"></i></span>
              <span class="sidebar-menu-text">الحضور والغياب</span>
            </a>
          </li>
          <li class="sidebar-menu-item">
            <a href="{{ url_for('mobile.departments') }}" class="sidebar-menu-link {{ 'active' if 'departments' in request.endpoint }}">
              <span class="sidebar-menu-icon"><i class="fas fa-building"></i></span>
              <span class="sidebar-menu-text">الأقسام</span>
            </a>
          </li>
          <li class="sidebar-menu-item">
            <a href="{{ url_for('mobile.salaries') }}" class="sidebar-menu-link {{ 'active' if 'salaries' in request.endpoint }}">
              <span class="sidebar-menu-icon"><i class="fas fa-money-bill-wave"></i></span>
              <span class="sidebar-menu-text">الرواتب</span>
            </a>
          </li>
          <li class="sidebar-menu-item">
            <a href="{{ url_for('mobile.documents') }}" class="sidebar-menu-link {{ 'active' if 'documents' in request.endpoint }}">
              <span class="sidebar-menu-icon"><i class="fas fa-file-alt"></i></span>
              <span class="sidebar-menu-text">الوثائق</span>
            </a>
          </li>
          <li class="sidebar-menu-item">
            <a href="{{ url_for('mobile.vehicles') }}" class="sidebar-menu-link {{ 'active' if 'vehicles' in request.endpoint }}">
              <span class="sidebar-menu-icon"><i class="fas fa-car"></i></span>
              <span class="sidebar-menu-text">السيارات</span>
            </a>
          </li>
          
          {% if current_user.role == 'admin' %}
          <li class="sidebar-menu-item">
            <a href="{{ url_for('mobile.operations_dashboard') }}" class="sidebar-menu-link {{ 'active' if 'operations' in request.endpoint }}">
              <span class="sidebar-menu-icon"><i class="fas fa-cogs"></i></span>
              <span class="sidebar-menu-text">إدارة العمليات</span>
            </a>
          </li>
          {% endif %}
          
          <li class="sidebar-menu-item">
            <a href="{{ url_for('mobile.create_handover_mobile') }}" class="sidebar-menu-link {{ 'active' if 'create_handover' in request.endpoint }}">
              <span class="sidebar-menu-icon"><i class="fas fa-clipboard-check"></i></span>
              <span class="sidebar-menu-text">تشيك لست السيارات</span>
            </a>
          </li>
          
          <li class="sidebar-menu-item">
            <a href="{{ url_for('mobile.fees_old') }}" class="sidebar-menu-link {{ 'active' if 'fees' in request.endpoint }}">
              <span class="sidebar-menu-icon"><i class="fas fa-dollar-sign"></i></span>
              <span class="sidebar-menu-text">الرسوم والتكاليف</span>
            </a>
          </li>
          
          <!-- الميزات الجديدة المضافة للتطبيق المحمول -->
          <li class="sidebar-menu-item">
            <a href="{{ url_for('mobile.users_new') }}" class="sidebar-menu-link {{ 'active' if 'users_new' in request.endpoint }}">
              <span class="sidebar-menu-icon"><i class="fas fa-user-cog"></i></span>
              <span class="sidebar-menu-text">إدارة المستخدمين</span>
            </a>
          </li>
          <li class="sidebar-menu-item">
            <a href="{{ url_for('mobile.fees_new') }}" class="sidebar-menu-link {{ 'active' if 'fees_new' in request.endpoint }}">
              <span class="sidebar-menu-icon"><i class="fas fa-receipt"></i></span>
              <span class="sidebar-menu-text">الرسوم والتكاليف (مطور)</span>
            </a>
          </li>
        </ul>
      </div>
      
      <div class="sidebar-menu">
        <div class="sidebar-menu-title">إضافي</div>
        <ul class="sidebar-menu-items">
          <li class="sidebar-menu-item">
            <a href="{{ url_for('mobile.reports') }}" class="sidebar-menu-link {{ 'active' if 'reports' in request.endpoint }}">
              <span class="sidebar-menu-icon"><i class="fas fa-chart-bar"></i></span>
              <span class="sidebar-menu-text">التقارير</span>
            </a>
          </li>
          <li class="sidebar-menu-item">
            <a href="{{ url_for('mobile.notifications') }}" class="sidebar-menu-link {{ 'active' if request.endpoint == 'mobile.notifications' }}">
              <span class="sidebar-menu-icon"><i class="fas fa-bell"></i></span>
              <span class="sidebar-menu-text">الإشعارات</span>
              {% if notifications_count and notifications_count > 0 %}
              <span class="badge bg-danger rounded-pill">{{ notifications_count }}</span>
              {% endif %}
            </a>
          </li>
          <li class="sidebar-menu-item">
            <a href="{{ url_for('mobile.settings') }}" class="sidebar-menu-link {{ 'active' if request.endpoint == 'mobile.settings' }}">
              <span class="sidebar-menu-icon"><i class="fas fa-cog"></i></span>
              <span class="sidebar-menu-text">الإعدادات</span>
            </a>
          </li>
          <li class="sidebar-menu-item">
            <a href="{{ url_for('mobile.profile') }}" class="sidebar-menu-link {{ 'active' if request.endpoint == 'mobile.profile' }}">
              <span class="sidebar-menu-icon"><i class="fas fa-user"></i></span>
              <span class="sidebar-menu-text">الملف الشخصي</span>
            </a>
          </li>
          {% if current_user.is_authenticated %}
          <li class="sidebar-menu-item">
            <a href="{{ url_for('mobile.logout') }}" class="sidebar-menu-link">
              <span class="sidebar-menu-icon"><i class="fas fa-sign-out-alt"></i></span>
              <span class="sidebar-menu-text">تسجيل الخروج</span>
            </a>
          </li>
          {% endif %}
        </ul>
      </div>
    </div>
    
    <!-- تراكب الظل للقائمة الجانبية -->
    <div class="mobile-overlay" id="overlay"></div>
    
    <!-- محتوى الصفحة -->
    <div class="mobile-content-wrapper">
      <main class="mobile-content">
        {% block content %}{% endblock %}
      </main>
    </div>
    
    <!-- شريط التنقل السفلي -->
    <nav class="mobile-footer">
      <div class="mobile-footer-items">
        <a href="{{ url_for('mobile.index') }}" class="mobile-footer-item {{ 'active' if request.endpoint == 'mobile.index' }}">
          <i class="fas fa-home"></i>
          <span>الرئيسية</span>
        </a>
        <a href="{{ url_for('mobile.employees') }}" class="mobile-footer-item {{ 'active' if 'employees' in request.endpoint }}">
          <i class="fas fa-users"></i>
          <span>الموظفين</span>
        </a>
        <a href="{{ url_for('mobile.vehicles') }}" class="mobile-footer-item {{ 'active' if 'vehicles' in request.endpoint }}">
          <i class="fas fa-car"></i>
          <span>السيارات</span>
        </a>
        <a href="{{ url_for('mobile.reports') }}" class="mobile-footer-item {{ 'active' if 'reports' in request.endpoint }}">
          <i class="fas fa-chart-bar"></i>
          <span>التقارير</span>
        </a>
      </div>
    </nav>
  </div>
  
  <!-- JavaScript Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Select2 JS -->
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

  <!-- التطبيق JavaScript الأساسي -->
  <script src="{{ url_for('static', filename='mobile/js/mobile-app.js') }}"></script>
  
  {% block scripts %}{% endblock %}
</body>
</html>